<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="theme-color" content="#1B5E20" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>Samurai Cricket Club</title>
  <style>
    /* â”€â”€ CSS Reset & Variables â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    :root {
      --primary: #1B5E20;
      --primary-light: #2E7D32;
      --primary-dark: #0D3B12;
      --accent: #FFB300;
      --accent-light: #FFD54F;
      --income: #2E7D32;
      --expense: #C62828;
      --sponsor: #1565C0;
      --bg: #F0F2F5;
      --card: #FFFFFF;
      --text: #1A1A2E;
      --text-secondary: #6B7280;
      --border: #E5E7EB;
      --shadow: 0 2px 12px rgba(0,0,0,0.08);
      --radius: 16px;
      --nav-height: 64px;
      --header-height: 56px;
      --safe-top: env(safe-area-inset-top, 0px);
      --safe-bottom: env(safe-area-inset-bottom, 0px);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100dvh;
      overflow-x: hidden;
      -webkit-tap-highlight-color: transparent;
      padding-top: calc(var(--header-height) + var(--safe-top));
      padding-bottom: calc(var(--nav-height) + var(--safe-bottom) + 16px);
    }

    /* â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .header {
      position: fixed; top: 0; left: 0; right: 0;
      height: calc(var(--header-height) + var(--safe-top));
      padding-top: var(--safe-top);
      background: var(--primary);
      color: white;
      display: flex; align-items: center; justify-content: space-between;
      padding-left: 20px; padding-right: 12px;
      z-index: 100;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    .header h1 { font-size: 18px; font-weight: 700; letter-spacing: 0.3px; }
    .header-icon {
      width: 40px; height: 40px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      background: rgba(255,255,255,0.15); cursor: pointer;
      border: none; color: white; font-size: 20px;
      transition: background 0.2s;
    }
    .header-icon:hover { background: rgba(255,255,255,0.25); }

    /* â”€â”€ Bottom Navigation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .bottom-nav {
      position: fixed; bottom: 0; left: 0; right: 0;
      height: calc(var(--nav-height) + var(--safe-bottom));
      padding-bottom: var(--safe-bottom);
      background: var(--card);
      display: flex; align-items: stretch;
      border-top: 1px solid var(--border);
      z-index: 100;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.06);
    }
    .nav-item {
      flex: 1; display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      text-decoration: none; color: var(--text-secondary);
      font-size: 11px; font-weight: 500; gap: 4px;
      cursor: pointer; border: none; background: none;
      transition: color 0.2s;
      -webkit-tap-highlight-color: transparent;
    }
    .nav-item.active { color: var(--primary); }
    .nav-item .nav-icon { font-size: 22px; line-height: 1; }

    /* â”€â”€ Page Sections â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .page { display: none; padding: 16px; animation: fadeIn 0.25s ease; }
    .page.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

    /* â”€â”€ Balance Hero Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .balance-card {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 50%, #43A047 100%);
      border-radius: var(--radius);
      padding: 28px 24px;
      color: white;
      margin-bottom: 20px;
      position: relative;
      overflow: hidden;
    }
    .balance-card::before {
      content: 'ğŸ';
      position: absolute; right: -10px; top: -10px;
      font-size: 120px; opacity: 0.1;
      transform: rotate(-20deg);
    }
    .balance-label { font-size: 13px; opacity: 0.85; text-transform: uppercase; letter-spacing: 1px; }
    .balance-amount { font-size: 40px; font-weight: 800; margin: 8px 0 4px; letter-spacing: -1px; }
    .balance-sub { font-size: 13px; opacity: 0.75; }

    /* â”€â”€ Stats Row â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .stats-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 20px; }
    .stat-card {
      background: var(--card);
      border-radius: 12px;
      padding: 16px 12px;
      text-align: center;
      box-shadow: var(--shadow);
    }
    .stat-icon { font-size: 24px; margin-bottom: 6px; }
    .stat-value { font-size: 18px; font-weight: 700; }
    .stat-label { font-size: 11px; color: var(--text-secondary); margin-top: 2px; text-transform: uppercase; letter-spacing: 0.5px; }
    .stat-card.income .stat-value { color: var(--income); }
    .stat-card.expense .stat-value { color: var(--expense); }
    .stat-card.sponsor .stat-value { color: var(--sponsor); }

    /* â”€â”€ Section Headers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .section-title {
      font-size: 16px; font-weight: 700; margin-bottom: 12px;
      display: flex; align-items: center; justify-content: space-between;
    }
    .section-title .see-all { font-size: 13px; color: var(--primary); font-weight: 600; cursor: pointer; border: none; background: none; }

    /* â”€â”€ Transaction List â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .tx-list { display: flex; flex-direction: column; gap: 8px; }
    .tx-item {
      background: var(--card);
      border-radius: 12px;
      padding: 14px 16px;
      display: flex; align-items: center; gap: 14px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.04);
      transition: transform 0.15s;
      position: relative;
    }
    .tx-item:active { transform: scale(0.98); }
    .tx-icon {
      width: 44px; height: 44px; border-radius: 12px;
      display: flex; align-items: center; justify-content: center;
      font-size: 20px; flex-shrink: 0;
    }
    .tx-icon.contribution { background: #E8F5E9; }
    .tx-icon.expense { background: #FFEBEE; }
    .tx-icon.sponsorship { background: #E3F2FD; }
    .tx-info { flex: 1; min-width: 0; }
    .tx-desc { font-weight: 600; font-size: 14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .tx-meta { font-size: 12px; color: var(--text-secondary); margin-top: 2px; }
    .tx-amount { font-weight: 700; font-size: 15px; flex-shrink: 0; text-align: right; }
    .tx-amount.positive { color: var(--income); }
    .tx-amount.negative { color: var(--expense); }
    .tx-delete {
      position: absolute; top: 8px; right: 8px;
      width: 28px; height: 28px; border-radius: 50%;
      border: none; background: #FFEBEE; color: var(--expense);
      font-size: 14px; cursor: pointer; display: none;
      align-items: center; justify-content: center;
    }
    .tx-item:hover .tx-delete, .tx-item:focus-within .tx-delete { display: flex; }

    /* â”€â”€ Forms â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .form-card {
      background: var(--card);
      border-radius: var(--radius);
      padding: 24px 20px;
      box-shadow: var(--shadow);
    }
    .type-selector { display: flex; gap: 8px; margin-bottom: 20px; }
    .type-btn {
      flex: 1; padding: 12px 8px; border-radius: 12px;
      border: 2px solid var(--border);
      background: var(--card); cursor: pointer;
      text-align: center; font-size: 12px; font-weight: 600;
      transition: all 0.2s; color: var(--text-secondary);
    }
    .type-btn .type-emoji { font-size: 24px; display: block; margin-bottom: 4px; }
    .type-btn.active.contribution { border-color: var(--income); background: #E8F5E9; color: var(--income); }
    .type-btn.active.expense { border-color: var(--expense); background: #FFEBEE; color: var(--expense); }
    .type-btn.active.sponsorship { border-color: var(--sponsor); background: #E3F2FD; color: var(--sponsor); }

    .form-group { margin-bottom: 16px; }
    .form-group label {
      display: block; font-size: 13px; font-weight: 600;
      color: var(--text-secondary); margin-bottom: 6px;
      text-transform: uppercase; letter-spacing: 0.5px;
    }
    .form-group input, .form-group select, .form-group textarea {
      width: 100%; padding: 14px 16px; border-radius: 12px;
      border: 2px solid var(--border); font-size: 16px;
      background: #FAFAFA; color: var(--text);
      outline: none; transition: border-color 0.2s;
      font-family: inherit;
    }
    .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
      border-color: var(--primary); background: white;
    }
    .amount-input {
      font-size: 32px !important; font-weight: 700 !important;
      text-align: center; letter-spacing: 1px;
    }
    .amount-prefix {
      display: flex; align-items: center; gap: 8px;
    }
    .amount-prefix .currency {
      font-size: 28px; font-weight: 700; color: var(--text-secondary);
      flex-shrink: 0;
    }
    .amount-prefix input { border: none; border-bottom: 3px solid var(--border); border-radius: 0; background: transparent; }
    .amount-prefix input:focus { border-bottom-color: var(--primary); }

    .submit-btn {
      width: 100%; padding: 16px; border-radius: 12px;
      border: none; font-size: 16px; font-weight: 700;
      color: white; cursor: pointer;
      background: var(--primary);
      transition: all 0.2s; margin-top: 8px;
      letter-spacing: 0.5px;
    }
    .submit-btn:active { transform: scale(0.98); filter: brightness(0.9); }
    .submit-btn:disabled { opacity: 0.5; cursor: not-allowed; }

    /* â”€â”€ Filter Chips â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .filter-row { display: flex; gap: 8px; margin-bottom: 16px; overflow-x: auto; padding-bottom: 4px; }
    .filter-row::-webkit-scrollbar { display: none; }
    .chip {
      padding: 8px 16px; border-radius: 20px;
      border: 1.5px solid var(--border);
      background: var(--card); cursor: pointer;
      font-size: 13px; font-weight: 600; white-space: nowrap;
      transition: all 0.2s; color: var(--text-secondary);
    }
    .chip.active { background: var(--primary); color: white; border-color: var(--primary); }

    /* â”€â”€ Search â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .search-box {
      position: relative; margin-bottom: 16px;
    }
    .search-box input {
      width: 100%; padding: 12px 16px 12px 44px;
      border-radius: 12px; border: 2px solid var(--border);
      font-size: 15px; background: var(--card); outline: none;
      transition: border-color 0.2s;
    }
    .search-box input:focus { border-color: var(--primary); }
    .search-box::before {
      content: 'ğŸ”'; position: absolute; left: 14px; top: 50%;
      transform: translateY(-50%); font-size: 18px;
    }

    /* â”€â”€ Empty State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .empty-state {
      text-align: center; padding: 48px 24px; color: var(--text-secondary);
    }
    .empty-state .empty-icon { font-size: 64px; margin-bottom: 16px; }
    .empty-state h3 { font-size: 18px; color: var(--text); margin-bottom: 8px; }
    .empty-state p { font-size: 14px; line-height: 1.5; }

    /* â”€â”€ Settings Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .modal-overlay {
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.5);
      z-index: 200; display: none;
      align-items: flex-end; justify-content: center;
      animation: fadeIn 0.2s ease;
    }
    .modal-overlay.show { display: flex; }
    .modal {
      background: var(--card);
      border-radius: 20px 20px 0 0;
      padding: 24px 20px calc(24px + var(--safe-bottom));
      width: 100%; max-width: 500px;
      max-height: 85vh; overflow-y: auto;
      animation: slideUp 0.3s ease;
    }
    @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
    .modal-handle {
      width: 36px; height: 4px; border-radius: 2px;
      background: #D1D5DB; margin: 0 auto 20px;
    }
    .modal h2 { font-size: 20px; margin-bottom: 20px; }
    .modal .form-group { margin-bottom: 16px; }
    .modal .close-btn {
      width: 100%; padding: 14px; border-radius: 12px;
      border: 2px solid var(--border); background: var(--card);
      font-size: 15px; font-weight: 600; cursor: pointer;
      margin-top: 12px; color: var(--text);
    }

    /* â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .toast {
      position: fixed; bottom: calc(var(--nav-height) + var(--safe-bottom) + 20px);
      left: 50%; transform: translateX(-50%) translateY(100px);
      background: #323232; color: white;
      padding: 14px 24px; border-radius: 12px;
      font-size: 14px; font-weight: 500;
      z-index: 300; opacity: 0;
      transition: all 0.3s ease;
      max-width: calc(100% - 40px);
      text-align: center;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    }
    .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
    .toast.error { background: var(--expense); }
    .toast.success { background: var(--income); }

    /* â”€â”€ Loading Spinner â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .spinner {
      display: inline-block; width: 20px; height: 20px;
      border: 3px solid rgba(255,255,255,0.3);
      border-top-color: white; border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* â”€â”€ Connection Status â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .connection-status {
      display: flex; align-items: center; gap: 6px;
      font-size: 11px; padding: 6px 12px; border-radius: 20px;
      font-weight: 600;
    }
    .connection-status.online { background: #E8F5E9; color: var(--income); }
    .connection-status.offline { background: #FFF3E0; color: #E65100; }
    .status-dot {
      width: 8px; height: 8px; border-radius: 50%;
    }
    .connection-status.online .status-dot { background: var(--income); }
    .connection-status.offline .status-dot { background: #E65100; }

    /* â”€â”€ Members List â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .member-item {
      background: var(--card); border-radius: 12px;
      padding: 14px 16px; display: flex;
      align-items: center; gap: 12px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.04);
    }
    .member-avatar {
      width: 40px; height: 40px; border-radius: 50%;
      background: var(--primary); color: white;
      display: flex; align-items: center; justify-content: center;
      font-weight: 700; font-size: 16px;
    }
    .add-member-row {
      display: flex; gap: 8px; margin-bottom: 16px;
    }
    .add-member-row input { flex: 1; padding: 12px 16px; border-radius: 12px; border: 2px solid var(--border); font-size: 15px; outline: none; }
    .add-member-row input:focus { border-color: var(--primary); }
    .add-member-row button {
      padding: 12px 20px; border-radius: 12px; border: none;
      background: var(--primary); color: white;
      font-weight: 700; font-size: 14px; cursor: pointer;
      white-space: nowrap;
    }

    /* â”€â”€ Utility â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .mt-8 { margin-top: 8px; }
    .mb-16 { margin-bottom: 16px; }
    .text-center { text-align: center; }

    /* â”€â”€ Setup Banner â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .setup-banner {
      background: linear-gradient(135deg, #FFF3E0, #FFE0B2);
      border: 2px solid #FFB74D;
      border-radius: var(--radius);
      padding: 16px 20px;
      margin-bottom: 16px;
      cursor: pointer;
      transition: transform 0.15s;
    }
    .setup-banner:active { transform: scale(0.98); }
    .setup-banner h3 { font-size: 14px; color: #E65100; margin-bottom: 4px; }
    .setup-banner p { font-size: 12px; color: #BF360C; line-height: 1.4; }

    /* Responsive */
    @media (min-width: 500px) {
      .page { max-width: 480px; margin-left: auto; margin-right: auto; }
    }
  </style>
</head>
<body>

  <!-- â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <header class="header">
    <h1>ğŸ Samurai Cricket Club</h1>
    <div style="display:flex;gap:8px;align-items:center;">
      <div id="connStatus" class="connection-status online">
        <span class="status-dot"></span> <span id="connLabel">Cloud</span>
      </div>
      <button class="header-icon" onclick="promptTreasurerPin()" aria-label="Settings">âš™ï¸</button>
    </div>
  </header>

  <!-- â”€â”€ Dashboard Page â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <section id="page-dashboard" class="page active">

    <div class="balance-card">
      <div class="balance-label">Team Balance</div>
      <div class="balance-amount" id="balanceDisplay">â‚¹0</div>
      <div class="balance-sub" id="balanceSub">Contributions + Sponsorships âˆ’ Expenses</div>
    </div>

    <div class="stats-row">
      <div class="stat-card income">
        <div class="stat-icon">ğŸ’°</div>
        <div class="stat-value" id="statContributions">â‚¹0</div>
        <div class="stat-label">Contributions</div>
      </div>
      <div class="stat-card expense">
        <div class="stat-icon">ğŸ§¾</div>
        <div class="stat-value" id="statExpenses">â‚¹0</div>
        <div class="stat-label">Expenses</div>
      </div>
      <div class="stat-card sponsor">
        <div class="stat-icon">ğŸ¤</div>
        <div class="stat-value" id="statSponsorships">â‚¹0</div>
        <div class="stat-label">Sponsors</div>
      </div>
    </div>

    <div class="section-title">
      Recent Transactions
      <button class="see-all" onclick="switchTab('history')">See All â†’</button>
    </div>
    <div id="recentTxList" class="tx-list"></div>

  </section>

  <!-- â”€â”€ Add Transaction Page â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <section id="page-add" class="page">
    <div class="form-card">
      <div class="section-title" style="margin-bottom:16px;">Record Transaction</div>

      <div class="type-selector">
        <button class="type-btn contribution active" data-type="Contribution" onclick="selectType(this)">
          <span class="type-emoji">ğŸ’°</span> Contribution
        </button>
        <button class="type-btn expense" data-type="Expense" onclick="selectType(this)">
          <span class="type-emoji">ğŸ§¾</span> Expense
        </button>
        <button class="type-btn sponsorship" data-type="Sponsorship" onclick="selectType(this)">
          <span class="type-emoji">ğŸ¤</span> Sponsorship
        </button>
      </div>

      <div class="form-group">
        <label>Amount (â‚¹)</label>
        <div class="amount-prefix">
          <span class="currency">â‚¹</span>
          <input type="number" id="txAmount" class="amount-input" placeholder="0" min="0" step="any" inputmode="decimal" required />
        </div>
      </div>

      <div class="form-group">
        <label>Description</label>
        <input type="text" id="txDescription" placeholder="e.g. Ground booking for Sunday" required />
      </div>

      <div class="form-group">
        <label>Recorded By</label>
        <select id="txRecordedBy">
          <option value="">â€” Select Member â€”</option>
        </select>
      </div>

      <div class="form-group">
        <label>Date</label>
        <input type="date" id="txDate" />
      </div>

      <div class="form-group">
        <label>Category (Optional)</label>
        <select id="txCategory">
          <option value="">â€” None â€”</option>
          <option value="Ground Fees">Ground Fees</option>
          <option value="Equipment">Equipment</option>
          <option value="Jerseys">Jerseys</option>
          <option value="Travel">Travel</option>
          <option value="Food & Drinks">Food & Drinks</option>
          <option value="Tournament Entry">Tournament Entry</option>
          <option value="Umpire Fees">Umpire Fees</option>
          <option value="Awards & Trophies">Awards & Trophies</option>
          <option value="Monthly Dues">Monthly Dues</option>
          <option value="Match Day Collection">Match Day Collection</option>
          <option value="Sponsor Payment">Sponsor Payment</option>
          <option value="Miscellaneous">Miscellaneous</option>
        </select>
      </div>

      <button class="submit-btn" id="submitBtn" onclick="submitTransaction()">
        Add Transaction
      </button>
    </div>
  </section>

  <!-- â”€â”€ History Page â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <section id="page-history" class="page">
    <div class="search-box">
      <input type="text" id="searchInput" placeholder="Search transactions..." oninput="renderHistory()" />
    </div>

    <div class="filter-row">
      <button class="chip active" data-filter="All" onclick="setFilter(this)">All</button>
      <button class="chip" data-filter="Contribution" onclick="setFilter(this)">ğŸ’° Contributions</button>
      <button class="chip" data-filter="Expense" onclick="setFilter(this)">ğŸ§¾ Expenses</button>
      <button class="chip" data-filter="Sponsorship" onclick="setFilter(this)">ğŸ¤ Sponsorships</button>
    </div>

    <div id="historyTxList" class="tx-list"></div>
  </section>

  <!-- â”€â”€ Members Page â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <section id="page-members" class="page">
    <div class="section-title" style="margin-bottom:16px;">Team Members</div>

    <div class="add-member-row">
      <input type="text" id="newMemberName" placeholder="Enter member name" />
      <button onclick="addMember()">+ Add</button>
    </div>

    <div id="membersList" class="tx-list"></div>
  </section>

  <!-- â”€â”€ Settings Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div id="settingsModal" class="modal-overlay" onclick="if(event.target===this)closeSettings()">
    <div class="modal">
      <div class="modal-handle"></div>
      <h2>âš™ï¸ Settings</h2>

      <div class="form-group">
        <label>Google Apps Script URL</label>
        <input type="url" id="apiUrl" placeholder="https://script.google.com/macros/s/.../exec" />
        <p style="font-size:11px;color:var(--text-secondary);margin-top:6px;line-height:1.4;">
          Paste the Web App URL from your Google Apps Script deployment. See README for setup instructions.
        </p>
      </div>

      <div class="form-group">
        <label>Your Name (Default Recorder)</label>
        <input type="text" id="defaultRecorder" placeholder="e.g. Venu" />
      </div>

      <div class="form-group">
        <label>Currency Symbol</label>
        <input type="text" id="currencySymbol" placeholder="â‚¹" maxlength="3" style="width:80px;" />
      </div>

      <button class="submit-btn" onclick="saveSettings()" style="margin-bottom:8px;">Save Settings</button>

      <div style="border-top:1px solid var(--border);margin:16px 0;padding-top:16px;">
        <div class="section-title" style="margin-bottom:12px;">Data Management</div>
        <div style="display:flex;gap:8px;flex-wrap:wrap;">
          <button class="close-btn" onclick="exportData()" style="flex:1;min-width:120px;">ğŸ“¤ Export JSON</button>
          <button class="close-btn" onclick="document.getElementById('importFile').click()" style="flex:1;min-width:120px;">ğŸ“¥ Import JSON</button>
        </div>
        <input type="file" id="importFile" accept=".json" style="display:none;" onchange="importData(event)" />
        <p style="font-size:11px;color:var(--text-secondary);margin-top:8px;line-height:1.4;">
          Export your data to share with team members or as a backup. Import to restore or merge data.
        </p>
      </div>

      <button class="close-btn" onclick="closeSettings()">Close</button>
    </div>
  </div>

  <!-- â”€â”€ Bottom Navigation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <nav class="bottom-nav">
    <button class="nav-item active" data-tab="dashboard" onclick="switchTab('dashboard')">
      <span class="nav-icon">ğŸ </span> Dashboard
    </button>
    <button class="nav-item" data-tab="add" onclick="switchTab('add')">
      <span class="nav-icon">â•</span> Record
    </button>
    <button class="nav-item" data-tab="history" onclick="switchTab('history')">
      <span class="nav-icon">ğŸ“‹</span> History
    </button>
    <button class="nav-item" data-tab="members" onclick="switchTab('members')">
      <span class="nav-icon">ğŸ‘¥</span> Members
    </button>
  </nav>

  <!-- â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div id="toast" class="toast"></div>

  <!-- â”€â”€ JavaScript â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <script>
    // â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    let transactions = [];
    let members = [];
    // Hardcoded API URL â€” this is the single source of truth. Settings can override it, but it always falls back here.
    const DEFAULT_API_URL = 'https://script.google.com/macros/s/AKfycbwTTXPt0rVbfRji69gcAsSuQChWJD3Rch09TjAJQxD8yt4us6XqrsK00zHN0rrxjUz9/exec';
    let settings = {
      apiUrl: DEFAULT_API_URL,
      defaultRecorder: '',
      currency: 'â‚¹'
    };
    let currentFilter = 'All';
    let isCloudMode = true;

    // â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    document.addEventListener('DOMContentLoaded', () => {
      unregisterSW(); // Clean up any old broken service workers
      loadSettings();
      loadLocalData();
      setDefaultDate();
      updateUI();
      syncFromCloud();
    });

    // Remove all previously registered service workers (they were causing cloud sync failures)
    function unregisterSW() {
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.getRegistrations().then(function(registrations) {
          registrations.forEach(function(reg) {
            reg.unregister();
            console.log('Service worker unregistered');
          });
        });
        // Also clear all caches left behind by old service workers
        if ('caches' in window) {
          caches.keys().then(function(names) {
            names.forEach(function(name) {
              caches.delete(name);
              console.log('Cache cleared:', name);
            });
          });
        }
      }
    }

    // â”€â”€ Settings â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function loadSettings() {
      const saved = localStorage.getItem('samurai_settings');
      if (saved) {
        const parsed = JSON.parse(saved);
        // Only override apiUrl if the saved value is non-empty; otherwise keep hardcoded default
        settings.defaultRecorder = parsed.defaultRecorder || '';
        settings.currency = parsed.currency || 'â‚¹';
        if (parsed.apiUrl && parsed.apiUrl.trim()) {
          settings.apiUrl = parsed.apiUrl.trim();
        }
      }
      isCloudMode = !!settings.apiUrl;
      document.getElementById('apiUrl').value = settings.apiUrl || '';
      document.getElementById('defaultRecorder').value = settings.defaultRecorder || '';
      document.getElementById('currencySymbol').value = settings.currency || 'â‚¹';
      updateConnectionStatus();
    }

    function saveSettings() {
      settings.apiUrl = document.getElementById('apiUrl').value.trim();
      settings.defaultRecorder = document.getElementById('defaultRecorder').value.trim();
      settings.currency = document.getElementById('currencySymbol').value.trim() || 'â‚¹';
      localStorage.setItem('samurai_settings', JSON.stringify(settings));
      isCloudMode = !!settings.apiUrl;
      updateConnectionStatus();
      closeSettings();
      showToast('Settings saved!', 'success');
      syncFromCloud();
      updateUI();
    }

    // â”€â”€ Treasurer-only Settings Access (PIN protected) â”€â”€â”€â”€â”€
    const TREASURER_PIN = '1234'; // Change this to your own secret PIN

    function promptTreasurerPin() {
      const pin = prompt('Enter Treasurer PIN:');
      if (pin === TREASURER_PIN) {
        openSettings();
      } else if (pin !== null) {
        showToast('Incorrect PIN', 'error');
      }
    }

    function openSettings() { document.getElementById('settingsModal').classList.add('show'); }
    function closeSettings() { document.getElementById('settingsModal').classList.remove('show'); }

    function updateConnectionStatus() {
      const el = document.getElementById('connStatus');
      const label = document.getElementById('connLabel');
      if (isCloudMode) {
        el.className = 'connection-status online';
        label.textContent = 'Cloud';
      } else {
        el.className = 'connection-status offline';
        label.textContent = 'Local';
      }
    }

    // â”€â”€ Local Storage â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function loadLocalData() {
      const txData = localStorage.getItem('samurai_transactions');
      const memData = localStorage.getItem('samurai_members');
      if (txData) transactions = JSON.parse(txData);
      if (memData) members = JSON.parse(memData);
    }

    function saveLocalData() {
      localStorage.setItem('samurai_transactions', JSON.stringify(transactions));
      localStorage.setItem('samurai_members', JSON.stringify(members));
    }

    // â”€â”€ Cloud Sync â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // All operations use GET requests for CORS compatibility
    function apiCall(action, params = {}) {
      if (!settings.apiUrl) return Promise.resolve(null);

      // Build URL with simple string concat (most compatible across browsers)
      const parts = ['action=' + encodeURIComponent(action)];
      Object.entries(params).forEach(([key, val]) => {
        if (val !== undefined && val !== null && val !== '') {
          parts.push(encodeURIComponent(key) + '=' + encodeURIComponent(String(val)));
        }
      });
      const separator = settings.apiUrl.includes('?') ? '&' : '?';
      const fullUrl = settings.apiUrl + separator + parts.join('&');

      return fetch(fullUrl)
        .then(function(res) { return res.json(); })
        .catch(function(err) {
          console.error('API Error (' + action + '):', err);
          return null;
        });
    }

    async function syncFromCloud() {
      if (!isCloudMode) return;
      const [txResult, memResult] = await Promise.all([
        apiCall('getAll'),
        apiCall('getMembers')
      ]);
      if (txResult && txResult.success) {
        transactions = txResult.data;
        saveLocalData();
      }
      if (memResult && memResult.success) {
        members = memResult.data;
        saveLocalData();
      }
      updateUI();
    }

    // â”€â”€ Tab Navigation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function switchTab(tab) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
      document.getElementById('page-' + tab).classList.add('active');
      document.querySelector(`.nav-item[data-tab="${tab}"]`).classList.add('active');

      if (tab === 'history') renderHistory();
      if (tab === 'members') renderMembers();
      if (tab === 'add') populateRecorderDropdown();
    }

    // â”€â”€ Type Selector â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function selectType(btn) {
      document.querySelectorAll('.type-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
    }

    function getSelectedType() {
      const active = document.querySelector('.type-btn.active');
      return active ? active.dataset.type : 'Contribution';
    }

    // â”€â”€ Add Transaction â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function setDefaultDate() {
      document.getElementById('txDate').value = new Date().toISOString().split('T')[0];
    }

    function populateRecorderDropdown() {
      const select = document.getElementById('txRecordedBy');
      const currentVal = select.value;

      // Keep existing options structure, rebuild dynamic ones
      select.innerHTML = '<option value="">â€” Select Member â€”</option>';

      members.forEach(name => {
        const opt = document.createElement('option');
        opt.value = name;
        opt.textContent = name;
        select.appendChild(opt);
      });

      // Add "Other" option
      const otherOpt = document.createElement('option');
      otherOpt.value = '__other__';
      otherOpt.textContent = '+ Type a name...';
      select.appendChild(otherOpt);

      // Restore previous selection or set default
      if (currentVal && [...select.options].some(o => o.value === currentVal)) {
        select.value = currentVal;
      } else if (settings.defaultRecorder && members.includes(settings.defaultRecorder)) {
        select.value = settings.defaultRecorder;
      }

      // Handle "Other" selection
      select.onchange = function () {
        if (this.value === '__other__') {
          const name = prompt('Enter name:');
          if (name && name.trim()) {
            this.value = '';
            const opt = document.createElement('option');
            opt.value = name.trim();
            opt.textContent = name.trim();
            select.insertBefore(opt, otherOpt);
            select.value = name.trim();
          } else {
            this.value = '';
          }
        }
      };
    }

    async function submitTransaction() {
      const amount = parseFloat(document.getElementById('txAmount').value);
      const description = document.getElementById('txDescription').value.trim();
      const recordedBy = document.getElementById('txRecordedBy').value;
      const date = document.getElementById('txDate').value;
      const category = document.getElementById('txCategory').value;
      const type = getSelectedType();

      // Validate
      if (!amount || amount <= 0) { showToast('Please enter a valid amount', 'error'); return; }
      if (!description) { showToast('Please enter a description', 'error'); return; }
      if (!recordedBy) { showToast('Please select who is recording this', 'error'); return; }

      const btn = document.getElementById('submitBtn');
      btn.disabled = true;
      btn.innerHTML = '<span class="spinner"></span> Saving...';

      const tx = {
        type, description, amount, recordedBy, date, category,
        id: generateId(),
        timestamp: new Date().toISOString()
      };

      if (isCloudMode) {
        const result = await apiCall('add', {
          type: tx.type, description: tx.description,
          amount: tx.amount, recordedBy: tx.recordedBy,
          date: tx.date, category: tx.category
        });
        if (result && result.success) {
          if (result.id) tx.id = result.id;
          showToast('Transaction saved to cloud! â˜ï¸', 'success');
          await syncFromCloud();
        } else {
          // Fallback to local
          transactions.push(tx);
          saveLocalData();
          showToast('Saved locally (cloud sync failed)', 'error');
        }
      } else {
        transactions.push(tx);
        saveLocalData();
        showToast('Transaction saved locally! ğŸ“±', 'success');
      }

      // Reset form
      document.getElementById('txAmount').value = '';
      document.getElementById('txDescription').value = '';
      document.getElementById('txCategory').value = '';
      setDefaultDate();
      btn.disabled = false;
      btn.textContent = 'Add Transaction';

      updateUI();
    }

    // â”€â”€ Delete Transaction â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function deleteTransaction(id) {
      if (!confirm('Delete this transaction?')) return;

      if (isCloudMode) {
        const result = await apiCall('delete', { id });
        if (result && result.success) {
          showToast('Deleted from cloud', 'success');
          await syncFromCloud();
        }
      }

      // Always remove locally too
      transactions = transactions.filter(t => t.id !== id);
      saveLocalData();
      updateUI();
    }

    // â”€â”€ Members â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function addMember() {
      const input = document.getElementById('newMemberName');
      const name = input.value.trim();
      if (!name) { showToast('Enter a name', 'error'); return; }

      if (members.some(m => m.toLowerCase() === name.toLowerCase())) {
        showToast('Member already exists', 'error');
        return;
      }

      if (isCloudMode) {
        const result = await apiCall('addMember', { name });
        if (result && result.success) {
          showToast('Member added to cloud! â˜ï¸', 'success');
          await syncFromCloud();
        } else {
          members.push(name);
          saveLocalData();
          showToast('Added locally', 'success');
        }
      } else {
        members.push(name);
        saveLocalData();
        showToast('Member added! ğŸ“±', 'success');
      }

      input.value = '';
      renderMembers();
    }

    function renderMembers() {
      const container = document.getElementById('membersList');
      if (members.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">ğŸ‘¥</div>
            <h3>No Members Yet</h3>
            <p>Add your team members above so they can be selected when recording transactions.</p>
          </div>`;
        return;
      }

      // Calculate individual balances
      const memberBalances = {};
      members.forEach(m => { memberBalances[m] = { contributions: 0, expenses: 0 }; });
      transactions.forEach(tx => {
        const name = tx.recordedby || tx.recordedBy || tx.RecordedBy || '';
        if (memberBalances[name] !== undefined) {
          const amt = parseFloat(tx.amount) || 0;
          if (tx.type === 'Contribution') memberBalances[name].contributions += amt;
          else if (tx.type === 'Expense') memberBalances[name].expenses += amt;
        }
      });

      container.innerHTML = members.map(name => {
        const initials = name.split(' ').map(w => w[0]).join('').toUpperCase().slice(0, 2);
        const balance = memberBalances[name] || { contributions: 0, expenses: 0 };
        const totalRecorded = balance.contributions + balance.expenses;
        return `
          <div class="member-item">
            <div class="member-avatar">${initials}</div>
            <div class="tx-info">
              <div class="tx-desc">${escapeHtml(name)}</div>
              <div class="tx-meta">${formatCurrency(balance.contributions)} contributed Â· ${formatCurrency(balance.expenses)} expenses recorded</div>
            </div>
          </div>`;
      }).join('');
    }

    // â”€â”€ UI Updates â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function updateUI() {
      updateBalanceCard();
      renderRecentTransactions();
      if (document.getElementById('page-history').classList.contains('active')) {
        renderHistory();
      }
      if (document.getElementById('page-members').classList.contains('active')) {
        renderMembers();
      }
      populateRecorderDropdown();
    }

    function updateBalanceCard() {
      let contributions = 0, expenses = 0, sponsorships = 0;

      transactions.forEach(tx => {
        const amount = parseFloat(tx.amount) || 0;
        if (tx.type === 'Contribution') contributions += amount;
        else if (tx.type === 'Expense') expenses += amount;
        else if (tx.type === 'Sponsorship') sponsorships += amount;
      });

      const balance = contributions + sponsorships - expenses;

      document.getElementById('balanceDisplay').textContent = formatCurrency(balance);
      document.getElementById('statContributions').textContent = formatCurrency(contributions);
      document.getElementById('statExpenses').textContent = formatCurrency(expenses);
      document.getElementById('statSponsorships').textContent = formatCurrency(sponsorships);
      document.getElementById('balanceSub').textContent =
        `${formatCurrency(contributions + sponsorships)} income âˆ’ ${formatCurrency(expenses)} spent`;
    }

    function renderRecentTransactions() {
      const container = document.getElementById('recentTxList');
      const sorted = [...transactions].sort((a, b) =>
        new Date(b.timestamp || b.date) - new Date(a.timestamp || a.date)
      );
      const recent = sorted.slice(0, 5);

      if (recent.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">ğŸ“</div>
            <h3>No Transactions Yet</h3>
            <p>Tap the <strong>Record</strong> tab below to add your first expense, contribution, or sponsorship.</p>
          </div>`;
        return;
      }

      container.innerHTML = recent.map(tx => renderTxItem(tx)).join('');
    }

    function renderHistory() {
      const container = document.getElementById('historyTxList');
      const query = document.getElementById('searchInput').value.toLowerCase();

      let filtered = [...transactions];

      if (currentFilter !== 'All') {
        filtered = filtered.filter(tx => tx.type === currentFilter);
      }

      if (query) {
        filtered = filtered.filter(tx =>
          (tx.description || '').toLowerCase().includes(query) ||
          (tx.recordedby || tx.recordedBy || '').toLowerCase().includes(query) ||
          (tx.category || '').toLowerCase().includes(query)
        );
      }

      filtered.sort((a, b) => new Date(b.timestamp || b.date) - new Date(a.timestamp || a.date));

      if (filtered.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">ğŸ”</div>
            <h3>No Transactions Found</h3>
            <p>Try changing your filters or search query.</p>
          </div>`;
        return;
      }

      container.innerHTML = filtered.map(tx => renderTxItem(tx, true)).join('');
    }

    function renderTxItem(tx, showDelete = false) {
      const amount = parseFloat(tx.amount) || 0;
      const type = tx.type || 'Contribution';
      const isPositive = type !== 'Expense';
      const icons = { Contribution: 'ğŸ’°', Expense: 'ğŸ§¾', Sponsorship: 'ğŸ¤' };
      const recorder = tx.recordedby || tx.recordedBy || tx.RecordedBy || 'Unknown';
      const dateStr = tx.date ? formatDate(tx.date) : '';
      const category = tx.category ? ` Â· ${tx.category}` : '';

      return `
        <div class="tx-item">
          <div class="tx-icon ${type.toLowerCase()}">${icons[type] || 'ğŸ“‹'}</div>
          <div class="tx-info">
            <div class="tx-desc">${escapeHtml(tx.description || 'No description')}</div>
            <div class="tx-meta">${escapeHtml(recorder)} Â· ${dateStr}${category}</div>
          </div>
          <div class="tx-amount ${isPositive ? 'positive' : 'negative'}">
            ${isPositive ? '+' : 'âˆ’'}${formatCurrency(amount)}
          </div>
          ${showDelete ? `<button class="tx-delete" onclick="deleteTransaction('${tx.id}')" title="Delete">âœ•</button>` : ''}
        </div>`;
    }

    // â”€â”€ Filter Chips â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function setFilter(chip) {
      document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
      chip.classList.add('active');
      currentFilter = chip.dataset.filter;
      renderHistory();
    }

    // â”€â”€ Export / Import â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function exportData() {
      const data = {
        team: 'Samurai Cricket Club',
        exportedAt: new Date().toISOString(),
        transactions, members, settings
      };
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `samurai-cc-data-${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      URL.revokeObjectURL(url);
      showToast('Data exported! Share the file with your team.', 'success');
    }

    function importData(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function (e) {
        try {
          const data = JSON.parse(e.target.result);
          if (data.transactions) {
            // Merge: add transactions that don't already exist
            const existingIds = new Set(transactions.map(t => t.id));
            const newTx = data.transactions.filter(t => !existingIds.has(t.id));
            transactions = [...transactions, ...newTx];
          }
          if (data.members) {
            const existingMembers = new Set(members.map(m => m.toLowerCase()));
            const newMembers = data.members.filter(m => !existingMembers.has(m.toLowerCase()));
            members = [...members, ...newMembers];
          }
          saveLocalData();
          updateUI();
          showToast(`Imported! ${data.transactions ? data.transactions.length : 0} transactions loaded.`, 'success');
        } catch (err) {
          showToast('Invalid file format', 'error');
        }
      };
      reader.readAsText(file);
      event.target.value = '';
    }

    // â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function formatCurrency(amount) {
      const sym = settings.currency || 'â‚¹';
      return sym + Math.abs(amount).toLocaleString('en-IN', {
        minimumFractionDigits: 0,
        maximumFractionDigits: 2
      });
    }

    function formatDate(dateStr) {
      try {
        const d = new Date(dateStr);
        return d.toLocaleDateString('en-IN', { day: 'numeric', month: 'short', year: 'numeric' });
      } catch {
        return dateStr;
      }
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function generateId() {
      return 'tx_' + Date.now() + '_' + Math.random().toString(36).slice(2, 9);
    }

    function showToast(message, type = '') {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.className = 'toast ' + type + ' show';
      clearTimeout(toast._timer);
      toast._timer = setTimeout(() => { toast.classList.remove('show'); }, 3000);
    }
  </script>

</body>
</html>
